{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if tarefa_editar %}
        <title>Editar Tarefa</title>
    {% else %}
        <title>Cadastrar Tarefa</title>
    {% endif %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'tarefas/css/tarefas.css' %}"> 
</head>
<body>
    <div class="row justify-content-center mb-5"> 
        <div class="col-md-4 text-center"> 
          <img src="{% static 'geral/img/LogoAvant1.jpg' %}" alt="Logo" class="img-fluid" style="margin-top: 50px; max-width: 200px; max-height: 100px;">
        </div> 
      </div>
    <div class="container mt-5">
        <h2 class="mb-4">{% if tarefa_editar %} Editar Tarefa {% else %} Cadastrar Tarefa {% endif %}</h2>

        <br>
        {% if messages %}
          {% for message in messages %}
              <section class="alert {{message.tags}}">
                  {{message}}
              </section>
          {% endfor %}
        {% endif %}
        <br>
        
        {% if tarefa_editar %}
            <form action="{% url 'editar_tarefa' tarefa_editar.id %}" method="POST"> {% csrf_token %}
        {% else %}
            <form action="{% url 'cadastrar_tarefa' %}" method="POST"> {% csrf_token %}
        {% endif %}
            <div class="mb-3">
                <label for="descricao" class="form-label">Descrição:</label>
                <input type="text" class="form-control" id="descricao" name="descricao" required {% if tarefa_editar %} value="{{tarefa_editar.descricao}}" {% endif %}>
            </div>
            <div class="mb-3">
                <label for="status" class="form-label">Status:</label>
                <select class="form-control" id="status" name="status">
                    {% for status_value, status_label in status_choices %}
                        <option value="{{ status_value }}" {% if tarefa_editar.status == status_value %} selected {% endif %} >{{ status_label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="prioridade" class="form-label">Prioridade:</label>
                <select class="form-control" id="prioridade" name="prioridade">
                    {% for prioridade_value, prioridade_label in prioridade_choices %}
                        <option value="{{ prioridade_value }}" {% if tarefa_editar.prioridade == prioridade_value %} selected {% endif %}>{{ prioridade_label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="obs" class="form-label">Observações (opcional):</label>
                <textarea class="form-control" id="obs" name="obs" >{% if tarefa_editar %} {{tarefa_editar.obs}} {% endif %}</textarea>
            </div>
            <div class="mb-3">
                <label for="progresso_conclusao" class="form-label">Progresso de Conclusão (opcional):</label>
                <input type="range" class="form-range" min="0" max="100" id="progresso_conclusao" name="progresso_conclusao" {% if tarefa_editar %} value="{{tarefa_editar.progresso_conclusao}}" {% else %} value="0" {% endif %}>
                <span id="progresso_valor" class="form-text">{% if tarefa_editar %} {{tarefa_editar.progresso_conclusao}}% {% else %} 0% {% endif %}</span>
            </div>
            <div class="mb-3">
                <label for="dataLimite" class="form-label">Data Limite (opcional):</label>
                
                <input type="date" class="form-control" id="dataLimite" name="dataLimite" {% if tarefa_editar %} value="{{ tarefa_editar.dataLimite|date:'Y-m-d' }}" {% endif %}>
            </div>
            <button type="submit" class="btn btn-primary">{% if tarefa_editar %} Editar {% else %} Cadastrar {% endif %}</button>

        </form>
        <br><br>
        <a href="{% url 'listar_tarefas' %}"  class="btn btn-dark">Listar Tarefas</a>
    </div>

    <script>
        const slider = document.getElementById("progresso_conclusao");
        const valorProgresso = document.getElementById("progresso_valor");

        slider.addEventListener("input", function() {
            valorProgresso.textContent = slider.value + "%";
        });
    </script>

</body>
</html>